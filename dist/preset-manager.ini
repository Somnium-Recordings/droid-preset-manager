# INPUTS:
#  I1: [XFade]

[p2b8]
[p2b8]

# -------------------------------------------------
# Config: Lights
# Colors for RBG Registers:
# 0.2 cyan
# 0.4 green
# 0.6 yellow
# 0.73 orange
# 0.8 red
# 1.0 magenta
# 1.1 violet
# 1.2 blue
# -------------------------------------------------

# Define: Color Min [static]
[copy]
  input = 1.2 # blue
  output = _COLOR_MIN

# Define: Color Max [static]
[copy]
  input = 0.8 # red
  output = _COLOR_MAX

[copy]
  input = 0.4 # cyan
  output = _COLOR_POT_FLASH_A

[copy]
  input = 0.78 # orange
  output = _COLOR_POT_FLASH_B

[copy]
  input = 1.2 # blue
  output = _COLOR_POT_LED_GAUGE_A

[copy]
  input = 0.8 # red
  output = _COLOR_POT_LED_GAUGE_B

# Define: Blink
[copy]
  input = _CLOCK_4_GATES
  output = _BLINK

# Define: Blink Inverted
[logic]
  input1 = _BLINK
  negated = _BLINK_INVERTED

[clocktool]
  clock = _BLINK
  output = _BLINK_SLOW
  divide = 4
  dutycycle = 0.125

# -------------------------------------------------
# Config: Midi
# -------------------------------------------------

# Define: _INTERNAL_CLOCK_4
[lfo]
  hz = 150 * 0.01666
  square = _INTERNAL_CLOCK_4

# Define: _MIDI_CLOCK_4
[midiin]
  running = _MIDI_CLOCK_RUNNING
  active = _MIDI_CLOCK_ACTIVE
  clock4 = _MIDI_CLOCK_4

[logic]
  input1 = _MIDI_CLOCK_RUNNING
  input2 = _MIDI_CLOCK_ACTIVE
  and = _USE_MIDI_CLOCK

[switch]
  input1 = _INTERNAL_CLOCK_4
  input2 = _MIDI_CLOCK_4
  offset = _USE_MIDI_CLOCK
  output1 = _CLOCK_4

[clocktool]
  dutycycle = 0.5
  clock = _CLOCK_4
  output = _CLOCK_4_GATES



# -------------------------------------------------
# Config: Outputs
# -------------------------------------------------

# Define: Default CV Voltage
[copy]
    input = 0.5
    output = _DEFAULT_CV_VOLTAGE

# -------------------------------------------------
# Control: Crossfader
# -------------------------------------------------

# (PM0) P0: X-Fade Default
[pot]
    selectat = _POT_MODE # 0 = "perform mode"
    select = 0
    pot = P1.1
    output = N1

# Set: POT_EDIT_CV_AB
# When in edit mode, set cross fade either all the way on or off depending on whether an "a" pot or "b" pot is being edited.

# Pot Mode 1-4 is "A/0" where 5-8 is "B/1"
[compare]
    input = _POT_EDIT_CV_MODE
    compare = 5
    ifless = 0
    else = 1
    output = _POT_EDIT_CV_AB

# Off in crossfader actually results in a value of 0. The voltage ends up being .0007 which means things don't completely turn off.
[compare]
    input = I1
    compare = 0.001
    ifless = 0
    else = I1
    output = _XFADE_INPUT_LOW_NORMALIZED

# TODO: validate whether this is needed once we can test outputs with the DATA
[compare]
    input = _XFADE_INPUT_LOW_NORMALIZED
    compare = 0.499
    ifgreater = 0.5
    ifless = _XFADE_INPUT_LOW_NORMALIZED
    output = _XFADE_INPUT_NORMALIZED

# Set: CROSSFADE
# Switch between hard panned crosfader (edit mode) and tracking the input (perform mode)
[switch]
    input1 = _XFADE_INPUT_NORMALIZED * 2
    input2 = _POT_EDIT_CV_AB
    offset = _BUTTON_MODE
    output1 = _CROSSFADE

# -------------------------------------------------
# Control: Mode Selector (B16)
# TODO: rename _BUTTOM_MODE to "mode"
# -------------------------------------------------

[button]
    longpress = _TOGGLE_BM
    button = B2.8

[flipflop]
    toggle = _TOGGLE_BM
    output = _BUTTON_MODE

[copy]
    input = _BUTTON_MODE * _BLINK
    output = L2.8

# -------------------------------------------------
# Control: Buttons -- Edit Mode
# -------------------------------------------------

# (BM1) B1.1-8: Pot Mode Selection
[buttongroup]
    button2 = B1.1
    button3 = B1.2
    button4 = B1.3
    button5 = B1.4
    button6 = B2.1
    button7 = B2.2
    button8 = B2.3
    button9 = B2.4
    select = _BUTTON_MODE
    selectat = 1
    led2 = L1.1
    led3 = L1.2
    led4 = L1.3
    led5 = L1.4
    led6 = L2.1
    led7 = L2.2
    led8 = L2.3
    led9 = L2.4
    output = _POT_EDIT_CV_MODE

# (BM1) B2.1: Gate 1 Toggle
[button]
    button = B1.5
    offvalue = 0
    onvalue = 1
    preset = _PRESET
    select = _BUTTON_MODE
    selectat = 1
    led = L1.5
    output = G9

# (BM1) B2.2: Gate 2 Toggle
[button]
    button = B1.6
    offvalue = 0
    onvalue = 1
    preset = _PRESET
    select = _BUTTON_MODE
    selectat = 1
    led = L1.6
    output = G10

# (BM1) B2.3: Gate 3 Toggle
[button]
    button = B1.7
    offvalue = 0
    onvalue = 1
    preset = _PRESET
    select = _BUTTON_MODE
    selectat = 1
    led = L1.7
    output = G11

# (BM1) B2.4: Gate 4 Toggle
[button]
    button = B1.8
    offvalue = 0
    onvalue = 1
    preset = _PRESET
    select = _BUTTON_MODE
    selectat = 1
    led = L1.8
    output = G12

# (BM1) B2.5-7: <unused>
[buttongroup]
    button1 = B2.5
    button2 = B2.6
    button3 = B2.7
    maxactive = 0
    preset = _PRESET
    select = _BUTTON_MODE
    selectat = 1
    led1 = L2.5
    led2 = L2.6
    led3 = L2.7

# -------------------------------------------------
# Control: Buttons -- Perform Mode
# 
# Presets count from left to right across modules.
# i.e.
# 1.1=1  | 1.2=2  | 2.1=3  | 2.2=4
# 1.3=5  | 1.4=6  | 2.3=7  | 2.4=8
# 1.5=9  | 1.6=10 | 2.5=11 | 2.6=12
# 1.7=13 | 1.8=14 | 2.7=15 | 2.8=<used-for-mode-switching>
# 
# -------------------------------------------------

# (BM0) Preset Selection
[buttongroup]
    button2 = B1.1
    button3 = B1.2
    button4 = B2.1
    button5 = B2.2
    button6 = B1.3
    button7 = B1.4
    button8 = B2.3
    button9 = B2.4
    button10 = B1.5
    button11 = B1.6
    button12 = B2.5
    button13 = B2.6
    button14 = B1.7
    button15 = B1.8
    button16 = B2.7
    select = _BUTTON_MODE
    selectat = 0
    startbutton = 2
    led2 = L1.1
    led3 = L1.2
    led4 = L2.1
    led5 = L2.2
    led6 = L1.3
    led7 = L1.4
    led8 = L2.3
    led9 = L2.4
    led10 = L1.5
    led11 = L1.6
    led12 = L2.5
    led13 = L2.6
    led14 = L1.7
    led15 = L1.8
    led16 = L2.7
    output = _PRESET

# Set pot mode based on button mode
# If in "perform" mode, then _POT_MODE is 0
[compare]
    input = _BUTTON_MODE
    compare = 0
    ifequal = 0
    else = _POT_EDIT_CV_MODE
    output = _POT_MODE

# -------------------------------------------------
# Control: CV1
# -------------------------------------------------

# P1.1: CV1.A
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 1
    output = _CV1_A

# P1.1: CV1.BL
[pot]
    pot = P1.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    lefthalf = _CV1_BL
    outputscale = _CV1_A

# P1.1: CV1.BR
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    righthalf = _CV1_BR
    outputscale = _CV1_A * -1 + 1

# Define: CV1.B
[math]
    input1 = _CV1_BR
    input2 = _CV1_BL
    difference = _CV1_B

# Define: CV1 Level
[crossfader]
    input1 = _CV1_A
    input2 = _CV1_B + _CV1_A
    fade = _CROSSFADE
    output = _CV1_LEVEL

# Output: CV1
[copy]
    input = _CV1_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O1

# -------------------------------------------------
# Control: CV2
# -------------------------------------------------

# P2.1: CV2.A
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 1
    output = _CV2_A

# P2.1: CV2.BL
[pot]
    pot = P2.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    lefthalf = _CV2_BL
    outputscale = _CV2_A

# P2.1: CV2.BR
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    righthalf = _CV2_BR
    outputscale = _CV2_A * -1 + 1

# Define: CV2.B
[math]
    input1 = _CV2_BR
    input2 = _CV2_BL
    difference = _CV2_B

# Define: CV2 Level
[crossfader]
    input1 = _CV2_A
    input2 = _CV2_B + _CV2_A
    fade = _CROSSFADE
    output = _CV2_LEVEL

# Output: CV2
[copy]
    input = _CV2_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O2

# -------------------------------------------------
# Control: CV3
# -------------------------------------------------

# P1.1: CV3.A
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 2
    output = _CV3_A

# P1.1: CV3.BL
[pot]
    pot = P1.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    lefthalf = _CV3_BL
    outputscale = _CV3_A

# P1.1: CV3.BR
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    righthalf = _CV3_BR
    outputscale = _CV3_A * -1 + 1

# Define: CV3.B
[math]
    input1 = _CV3_BR
    input2 = _CV3_BL
    difference = _CV3_B

# Define: CV3 Level
[crossfader]
    input1 = _CV3_A
    input2 = _CV3_B + _CV3_A
    fade = _CROSSFADE
    output = _CV3_LEVEL

# Output: CV3
[copy]
    input = _CV3_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O3

# -------------------------------------------------
# Control: CV4
# -------------------------------------------------

# P2.1: CV4.A
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 2
    output = _CV4_A

# P2.1: CV4.BL
[pot]
    pot = P2.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    lefthalf = _CV4_BL
    outputscale = _CV4_A

# P2.1: CV4.BR
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    righthalf = _CV4_BR
    outputscale = _CV4_A * -1 + 1

# Define: CV4.B
[math]
    input1 = _CV4_BR
    input2 = _CV4_BL
    difference = _CV4_B

# Define: CV4 Level
[crossfader]
    input1 = _CV4_A
    input2 = _CV4_B + _CV4_A
    fade = _CROSSFADE
    output = _CV4_LEVEL

# Output: CV4
[copy]
    input = _CV4_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O4

# -------------------------------------------------
# Control: CV5
# -------------------------------------------------

# P1.2: CV5.A
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 1
    output = _CV5_A

# P1.2: CV5.BL
[pot]
    pot = P1.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    lefthalf = _CV5_BL
    outputscale = _CV5_A

# P1.2: CV5.BR
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    righthalf = _CV5_BR
    outputscale = _CV5_A * -1 + 1

# Define: CV5.B
[math]
    input1 = _CV5_BR
    input2 = _CV5_BL
    difference = _CV5_B

# Define: CV5 Level
[crossfader]
    input1 = _CV5_A
    input2 = _CV5_B + _CV5_A
    fade = _CROSSFADE
    output = _CV5_LEVEL

# Output: CV5
[copy]
    input = _CV5_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O5

# -------------------------------------------------
# Control: CV6
# -------------------------------------------------

# P2.2: CV6.A
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 1
    output = _CV6_A

# P2.2: CV6.BL
[pot]
    pot = P2.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    lefthalf = _CV6_BL
    outputscale = _CV6_A

# P2.2: CV6.BR
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 5
    righthalf = _CV6_BR
    outputscale = _CV6_A * -1 + 1

# Define: CV6.B
[math]
    input1 = _CV6_BR
    input2 = _CV6_BL
    difference = _CV6_B

# Define: CV6 Level
[crossfader]
    input1 = _CV6_A
    input2 = _CV6_B + _CV6_A
    fade = _CROSSFADE
    output = _CV6_LEVEL

# Output: CV6
[copy]
    input = _CV6_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O6

# -------------------------------------------------
# Control: CV7
# -------------------------------------------------

# P1.2: CV7.A
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 2
    output = _CV7_A

# P1.2: CV7.BL
[pot]
    pot = P1.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    lefthalf = _CV7_BL
    outputscale = _CV7_A

# P1.2: CV7.BR
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    righthalf = _CV7_BR
    outputscale = _CV7_A * -1 + 1

# Define: CV7.B
[math]
    input1 = _CV7_BR
    input2 = _CV7_BL
    difference = _CV7_B

# Define: CV7 Level
[crossfader]
    input1 = _CV7_A
    input2 = _CV7_B + _CV7_A
    fade = _CROSSFADE
    output = _CV7_LEVEL

# Output: CV7
[copy]
    input = _CV7_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O7

# -------------------------------------------------
# Control: CV8
# -------------------------------------------------

# P2.2: CV8.A
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 2
    output = _CV8_A

# P2.2: CV8.BL
[pot]
    pot = P2.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    lefthalf = _CV8_BL
    outputscale = _CV8_A

# P2.2: CV8.BR
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 6
    righthalf = _CV8_BR
    outputscale = _CV8_A * -1 + 1

# Define: CV8.B
[math]
    input1 = _CV8_BR
    input2 = _CV8_BL
    difference = _CV8_B

# Define: CV8 Level
[crossfader]
    input1 = _CV8_A
    input2 = _CV8_B + _CV8_A
    fade = _CROSSFADE
    output = _CV8_LEVEL

# Output: CV8
[copy]
    input = _CV8_LEVEL * _DEFAULT_CV_VOLTAGE
    output = O8

# -------------------------------------------------
# Control: CV9
# -------------------------------------------------

# P1.1: CV9.A
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 3
    output = _CV9_A

# P1.1: CV9.BL
[pot]
    pot = P1.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    lefthalf = _CV9_BL
    outputscale = _CV9_A

# P1.1: CV9.BR
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    righthalf = _CV9_BR
    outputscale = _CV9_A * -1 + 1

# Define: CV9.B
[math]
    input1 = _CV9_BR
    input2 = _CV9_BL
    difference = _CV9_B

# Define: CV9 Level
[crossfader]
    input1 = _CV9_A
    input2 = _CV9_B + _CV9_A
    fade = _CROSSFADE
    output = _CV9_LEVEL

# -------------------------------------------------
# Control: CV10
# -------------------------------------------------

# P2.1: CV10.A
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 3
    output = _CV10_A

# P2.1: CV10.BL
[pot]
    pot = P2.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    lefthalf = _CV10_BL
    outputscale = _CV10_A

# P2.1: CV10.BR
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    righthalf = _CV10_BR
    outputscale = _CV10_A * -1 + 1

# Define: CV10.B
[math]
    input1 = _CV10_BR
    input2 = _CV10_BL
    difference = _CV10_B

# Define: CV10 Level
[crossfader]
    input1 = _CV10_A
    input2 = _CV10_B + _CV10_A
    fade = _CROSSFADE
    output = _CV10_LEVEL

# -------------------------------------------------
# Control: CV11
# -------------------------------------------------

# P1.1: CV11.A
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 4
    output = _CV11_A

# P1.1: CV11.BL
[pot]
    pot = P1.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    lefthalf = _CV11_BL
    outputscale = _CV11_A

# P1.1: CV11.BR
[pot]
    pot = P1.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    righthalf = _CV11_BR
    outputscale = _CV11_A * -1 + 1

# Define: CV11.B
[math]
    input1 = _CV11_BR
    input2 = _CV11_BL
    difference = _CV11_B

# Define: CV11 Level
[crossfader]
    input1 = _CV11_A
    input2 = _CV11_B + _CV11_A
    fade = _CROSSFADE
    output = _CV11_LEVEL

# -------------------------------------------------
# Control: CV12
# -------------------------------------------------

# P2.1: CV12.A
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 4
    output = _CV12_A

# P2.1: CV12.BL
[pot]
    pot = P2.1
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    lefthalf = _CV12_BL
    outputscale = _CV12_A

# P2.1: CV12.BR
[pot]
    pot = P2.1
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    righthalf = _CV12_BR
    outputscale = _CV12_A * -1 + 1

# Define: CV12.B
[math]
    input1 = _CV12_BR
    input2 = _CV12_BL
    difference = _CV12_B

# Define: CV12 Level
[crossfader]
    input1 = _CV12_A
    input2 = _CV12_B + _CV12_A
    fade = _CROSSFADE
    output = _CV12_LEVEL

# -------------------------------------------------
# Control: CV13
# -------------------------------------------------

# P1.2: CV13.A
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 3
    output = _CV13_A

# P1.2: CV13.BL
[pot]
    pot = P1.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    lefthalf = _CV13_BL
    outputscale = _CV13_A

# P1.2: CV13.BR
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    righthalf = _CV13_BR
    outputscale = _CV13_A * -1 + 1

# Define: CV13.B
[math]
    input1 = _CV13_BR
    input2 = _CV13_BL
    difference = _CV13_B

# Define: CV13 Level
[crossfader]
    input1 = _CV13_A
    input2 = _CV13_B + _CV13_A
    fade = _CROSSFADE
    output = _CV13_LEVEL

# -------------------------------------------------
# Control: CV14
# -------------------------------------------------

# P2.2: CV14.A
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 3
    output = _CV14_A

# P2.2: CV14.BL
[pot]
    pot = P2.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    lefthalf = _CV14_BL
    outputscale = _CV14_A

# P2.2: CV14.BR
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 7
    righthalf = _CV14_BR
    outputscale = _CV14_A * -1 + 1

# Define: CV14.B
[math]
    input1 = _CV14_BR
    input2 = _CV14_BL
    difference = _CV14_B

# Define: CV14 Level
[crossfader]
    input1 = _CV14_A
    input2 = _CV14_B + _CV14_A
    fade = _CROSSFADE
    output = _CV14_LEVEL

# -------------------------------------------------
# Control: CV15
# -------------------------------------------------

# P1.2: CV15.A
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 4
    output = _CV15_A

# P1.2: CV15.BL
[pot]
    pot = P1.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    lefthalf = _CV15_BL
    outputscale = _CV15_A

# P1.2: CV15.BR
[pot]
    pot = P1.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    righthalf = _CV15_BR
    outputscale = _CV15_A * -1 + 1

# Define: CV15.B
[math]
    input1 = _CV15_BR
    input2 = _CV15_BL
    difference = _CV15_B

# Define: CV15 Level
[crossfader]
    input1 = _CV15_A
    input2 = _CV15_B + _CV15_A
    fade = _CROSSFADE
    output = _CV15_LEVEL

# -------------------------------------------------
# Control: CV16
# -------------------------------------------------

# P2.2: CV16.A
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_A
    preset = _PRESET
    startvalue = 0
    selectat = _POT_MODE
    select = 4
    output = _CV16_A

# P2.2: CV16.BL
[pot]
    pot = P2.2
    ledgauge = off
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    lefthalf = _CV16_BL
    outputscale = _CV16_A

# P2.2: CV16.BR
[pot]
    pot = P2.2
    ledgauge = _COLOR_POT_LED_GAUGE_B
    preset = _PRESET
    notch = 0.1
    selectat = _POT_MODE
    select = 8
    righthalf = _CV16_BR
    outputscale = _CV16_A * -1 + 1

# Define: CV16.B
[math]
    input1 = _CV16_BR
    input2 = _CV16_BL
    difference = _CV16_B

# Define: CV16 Level
[crossfader]
    input1 = _CV16_A
    input2 = _CV16_B + _CV16_A
    fade = _CROSSFADE
    output = _CV16_LEVEL



# -------------------------------------------------
# Display: Lights
# -------------------------------------------------

# Display: CV1
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV1_LEVEL
    output = R1

# Display: CV2
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV2_LEVEL
    output = R2

# Display: CV3
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV3_LEVEL
    output = R3

# Display: CV4
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV4_LEVEL
    output = R4

# Display: CV5
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV5_LEVEL
    output = R5

# Display: CV6
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV6_LEVEL
    output = R6

# Display: CV7
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV7_LEVEL
    output = R7

# Display: CV8
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV8_LEVEL
    output = R8

# Display: CV9
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV9_LEVEL
    output = R9

# Display: CV10
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV10_LEVEL
    output = R10

# Display: CV11
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV11_LEVEL
    output = R11

# Display: CV12
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV12_LEVEL
    output = R12

# Display: CV13
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV13_LEVEL
    output = R13

# Display: CV14
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV14_LEVEL
    output = R14

# Display: CV15
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV15_LEVEL
    output = R15

# Display: CV16
[crossfader]
    input1 = _COLOR_MIN
    input2 = _COLOR_MAX
    fade = _CV16_LEVEL
    output = R16


# Blink: Preset 1 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 1
    input = 0
    output = R1

# Blink: Preset 2 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 2
    input = 0
    output = R2

# Blink: Preset 3 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 3
    input = 0
    output = R3

# Blink: Preset 4 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 4
    input = 0
    output = R4

# Blink: Preset 5 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 5
    input = 0
    output = R5

# Blink: Preset 6 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 6
    input = 0
    output = R6

# Blink: Preset 7 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 7
    input = 0
    output = R7

# Blink: Preset 8 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 8
    input = 0
    output = R8

# Blink: Preset 9 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 9
    input = 0
    output = R9

# Blink: Preset 10 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 10
    input = 0
    output = R10

# Blink: Preset 11 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 11
    input = 0
    output = R11

# Blink: Preset 12 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 12
    input = 0
    output = R12

# Blink: Preset 13 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 13
    input = 0
    output = R13

# Blink: Preset 14 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 14
    input = 0
    output = R14

# Blink: Preset 15 Selected
[select]
    select = _PRESET * _BLINK_INVERTED
    selectat = 15
    input = 0
    output = R15


# Flash: Edit CV P1.1-1 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 1
    input = _COLOR_POT_FLASH_A
    output = R1

# Flash: Edit CV P1.1-1 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 5
    input = _COLOR_POT_FLASH_B
    output = R1

# Flash: Edit CV P2.1-2 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 1
    input = _COLOR_POT_FLASH_A
    output = R2

# Flash: Edit CV P2.1-2 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 5
    input = _COLOR_POT_FLASH_B
    output = R2

# Flash: Edit CV P1.1-3 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 2
    input = _COLOR_POT_FLASH_A
    output = R3

# Flash: Edit CV P1.1-3 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 6
    input = _COLOR_POT_FLASH_B
    output = R3

# Flash: Edit CV P2.1-4 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 2
    input = _COLOR_POT_FLASH_A
    output = R4

# Flash: Edit CV P2.1-4 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 6
    input = _COLOR_POT_FLASH_B
    output = R4

# Flash: Edit CV P1.2-5 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 1
    input = _COLOR_POT_FLASH_A
    output = R5

# Flash: Edit CV P1.2-5 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 5
    input = _COLOR_POT_FLASH_B
    output = R5

# Flash: Edit CV P2.2-6 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 1
    input = _COLOR_POT_FLASH_A
    output = R6

# Flash: Edit CV P2.2-6 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 5
    input = _COLOR_POT_FLASH_B
    output = R6

# Flash: Edit CV P1.2-7 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 2
    input = _COLOR_POT_FLASH_A
    output = R7

# Flash: Edit CV P1.2-7 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 6
    input = _COLOR_POT_FLASH_B
    output = R7

# Flash: Edit CV P2.2-8 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 2
    input = _COLOR_POT_FLASH_A
    output = R8

# Flash: Edit CV P2.2-8 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 6
    input = _COLOR_POT_FLASH_B
    output = R8

# Flash: Edit CV P1.1-9 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 3
    input = _COLOR_POT_FLASH_A
    output = R9

# Flash: Edit CV P1.1-9 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 7
    input = _COLOR_POT_FLASH_B
    output = R9

# Flash: Edit CV P2.1-10 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 3
    input = _COLOR_POT_FLASH_A
    output = R10

# Flash: Edit CV P2.1-10 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 7
    input = _COLOR_POT_FLASH_B
    output = R10

# Flash: Edit CV P1.1-11 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 4
    input = _COLOR_POT_FLASH_A
    output = R11

# Flash: Edit CV P1.1-11 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 8
    input = _COLOR_POT_FLASH_B
    output = R11

# Flash: Edit CV P2.1-12 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 4
    input = _COLOR_POT_FLASH_A
    output = R12

# Flash: Edit CV P2.1-12 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 8
    input = _COLOR_POT_FLASH_B
    output = R12

# Flash: Edit CV P1.2-13 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 3
    input = _COLOR_POT_FLASH_A
    output = R13

# Flash: Edit CV P1.2-13 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 7
    input = _COLOR_POT_FLASH_B
    output = R13

# Flash: Edit CV P2.2-14 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 3
    input = _COLOR_POT_FLASH_A
    output = R14

# Flash: Edit CV P2.2-14 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 7
    input = _COLOR_POT_FLASH_B
    output = R14

# Flash: Edit CV P1.2-15 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 4
    input = _COLOR_POT_FLASH_A
    output = R15

# Flash: Edit CV P1.2-15 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 8
    input = _COLOR_POT_FLASH_B
    output = R15

# Flash: Edit CV P2.2-16 A
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 4
    input = _COLOR_POT_FLASH_A
    output = R16

# Flash: Edit CV P2.2-16 B
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 8
    input = _COLOR_POT_FLASH_B
    output = R16


# Blink: Pot Mode 1
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 1
    input = 0 # turn off led
    output = L1.1

# Blink: Pot Mode 2
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 2
    input = 0 # turn off led
    output = L1.2

# Blink: Pot Mode 3
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 3
    input = 0 # turn off led
    output = L1.3

# Blink: Pot Mode 4
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 4
    input = 0 # turn off led
    output = L1.4

# Blink: Pot Mode 5
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 5
    input = 0 # turn off led
    output = L2.1

# Blink: Pot Mode 6
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 6
    input = 0 # turn off led
    output = L2.2

# Blink: Pot Mode 7
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 7
    input = 0 # turn off led
    output = L2.3

# Blink: Pot Mode 8
[select]
    select = _POT_MODE * _BLINK_SLOW
    selectat = 8
    input = 0 # turn off led
    output = L2.4



# -------------------------------------------------
# Output: Midi
# -------------------------------------------------

[midiout]
    usb = 1
    trs = 0
    activesensing = 0
    channel = 16
    ccnumber1 = 1
    ccnumber2 = 2
    ccnumber3 = 3
    ccnumber4 = 4
    ccnumber5 = 5
    ccnumber6 = 6
    ccnumber7 = 7
    ccnumber8 = 8
    cc1 = _CV9_LEVEL
    cc2 = _CV10_LEVEL
    cc3 = _CV11_LEVEL
    cc4 = _CV12_LEVEL
    cc5 = _CV13_LEVEL
    cc6 = _CV14_LEVEL
    cc7 = _CV15_LEVEL
    cc8 = _CV16_LEVEL

